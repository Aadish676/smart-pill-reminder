{% extends "base.html" %}
{% block content %}
<div class="row">
  <div class="col-md-8">
    <h2>Notification Logs</h2>
  </div>
  <div class="col-md-4 text-end">
    <a href="{{ url_for('home') }}" class="btn btn-outline-secondary btn-sm">
      ‚Üê Back to Dashboard
    </a>
  </div>
</div>

<p class="text-muted">Recent notification attempts (last 50)</p>

{% if logs %}
<div class="table-responsive">
  <table class="table table-striped table-sm">
    <thead>
      <tr>
        <th>Timestamp</th>
        <th>Pill</th>
        <th>Type</th>
        <th>Status</th>
        <th>Error Message</th>
      </tr>
    </thead>
    <tbody>
      {% for log in logs %}
      <tr>
        <td>{{ log.timestamp.strftime('%Y-%m-%d %H:%M:%S') }}</td>
        <td>
          {% if log.pill_id in pills %}
            <strong>{{ pills[log.pill_id].name }}</strong><br>
            <small class="text-muted">{{ pills[log.pill_id].member.name }}</small>
          {% else %}
            <em>Unknown Pill</em>
          {% endif %}
        </td>
        <td>
          {% if log.notification_type == 'email' %}
            <span class="badge bg-primary">üìß Email</span>
          {% elif log.notification_type == 'sms' %}
            <span class="badge bg-success">üì± SMS</span>
          {% else %}
            <span class="badge bg-secondary">{{ log.notification_type }}</span>
          {% endif %}
        </td>
        <td>
          {% if log.status == 'sent' %}
            <span class="badge bg-success">‚úì Sent</span>
          {% elif log.status == 'failed' %}
            <span class="badge bg-danger">‚úó Failed</span>
          {% else %}
            <span class="badge bg-secondary">{{ log.status }}</span>
          {% endif %}
        </td>
        <td>
          {% if log.error_message %}
            <small class="text-danger">{{ log.error_message }}</small>
          {% else %}
            <small class="text-muted">-</small>
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% else %}
<div class="alert alert-info">
  <h5>No notification logs found</h5>
  <p>Notifications logs will appear here after the system attempts to send reminders. Try adding a pill scheduled for the current time and wait for the reminder to be sent.</p>
</div>
{% endif %}

<div class="mt-4">
  <h5>Notification System Status</h5>
  <ul class="list-unstyled">
    {% if email_enabled %}
      <li><span class="badge bg-success">‚úì</span> Email notifications are enabled</li>
    {% else %}
      <li><span class="badge bg-danger">‚úó</span> Email notifications are disabled (check MAIL_USERNAME and MAIL_PASSWORD environment variables)</li>
    {% endif %}
    
    {% if sms_enabled %}
      <li><span class="badge bg-success">‚úì</span> SMS/WhatsApp notifications are enabled</li>
    {% else %}
      <li><span class="badge bg-danger">‚úó</span> SMS/WhatsApp notifications are disabled (check TWILIO_SID, TWILIO_AUTH, and TWILIO_PHONE environment variables)</li>
    {% endif %}
  </ul>
</div>
{% endblock %}